<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Quản lý phòng - Bảng</title>
    <th:block th:replace="base :: bt"></th:block>
</head>
<body>
<th:block th:replace="base :: menu"></th:block>

<main class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">
            Quản lý phòng
            <span th:if="${#authorization.expression('hasRole(''HOUSEKEEPING'')')}" class="badge bg-secondary ms-2">Housekeeping</span>
            <span th:if="${#authorization.expression('hasRole(''RECEPTION'')')}" class="badge bg-primary ms-2">Reception</span>
        </h3>
    </div>

    <!-- Hiển thị thông báo lỗi nếu có -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>

    <div class="table-responsive shadow-sm">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Số phòng</th>
                    <th>Loại</th>
                    <th>Tầng</th>
                    <th>Trạng thái</th>
                    <th>Ảnh</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="r : ${rooms}">
                    <td th:text="${r.id}">1</td>
                    <td th:text="${r.roomNumber}">101</td>
                    <td th:text="${r.roomTypeId != null ? r.roomTypeId.name : ''}">Standard</td>
                    <td th:text="${r.floor}">1</td>
                    <td>
                        <!-- Form cập nhật trạng thái -->
                        <form th:action="@{${#authorization.expression('hasRole(''RECEPTION'')') 
                              ? '/reception/booking_manage/updateStatus' 
                              : '/housekeeping/booking_manage/updateStatus'}}" 
                              method="post" 
                              class="d-flex align-items-center">
                            <input type="hidden" name="id" th:value="${r.id}" />
                            <select name="status" class="form-select form-select-sm me-2">
                                <option value="AVAILABLE" th:selected="${r.status == 'AVAILABLE'}">Có sẵn</option>
                                <option value="OCCUPIED" th:selected="${r.status == 'OCCUPIED'}">Đang sử dụng</option>
                                <option value="MAINTENANCE" th:selected="${r.status == 'MAINTENANCE'}">Bảo trì</option>
                                <option value="CLEANING" th:selected="${r.status == 'CLEANING'}">Đang dọn dẹp</option>
                            </select>
                            <button type="submit" class="btn btn-sm btn-success">Cập nhật</button>
                        </form>
                    </td>
                    <td>
                        <img th:if="${r.imageUrl}" th:src="${r.imageUrl}" alt="image" style="height:40px; object-fit:cover;">
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(rooms)}">
                    <td colspan="6" class="text-center text-muted">Chưa có phòng</td>
                </tr>
            </tbody>
        </table>
    </div>
</main>

<th:block th:replace="base :: footer"></th:block>
</body>
</html>
