function toYMD(d){const m=(d.getMonth()+1).toString().padStart(2,'0');const day=d.getDate().toString().padStart(2,'0');return `${d.getFullYear()}-${m}-${day}`;}
function updateDateRange(){const p=document.getElementById('periodSelect');if(!p)return;const period=p.value;const year=parseInt(document.querySelector('select[name="year"]').value,10);const fromEl=document.querySelector('input[name="fromDate"]');const toEl=document.querySelector('input[name="toDate"]');const today=new Date();if(period==='MONTH'){const month=parseInt(document.querySelector('select[name="month"]').value,10);const from=new Date(year,month-1,1);const lastDay=new Date(year,month,0).getDate();const isCurrent=(year===today.getFullYear()&&month===today.getMonth()+1);const to=new Date(year,month-1,isCurrent?today.getDate():lastDay);fromEl.value=toYMD(from);toEl.value=toYMD(to);}else{const quarter=parseInt(document.querySelector('select[name="quarter"]').value,10);const startMonth=(quarter-1)*3;const from=new Date(year,startMonth,1);const end=new Date(year,startMonth+3,0);fromEl.value=toYMD(from);toEl.value=toYMD(end);}}
function togglePeriodControls(){const p=document.getElementById('periodSelect');if(!p)return;const v=p.value;const mg=document.getElementById('monthGroup');const qg=document.getElementById('quarterGroup');if(mg)mg.style.display=v==='MONTH'?'block':'none';if(qg)qg.style.display=v==='QUARTER'?'block':'none';}
window.SHMStats={updateDateRange,togglePeriodControls};

